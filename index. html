import React, { useState, useEffect, useMemo, useRef } from 'react';
import { 
  Search, BookOpen, Volume2, Play, Pause, RotateCcw, 
  X, Moon, Sun, Bookmark, BookmarkCheck, Share2, Info, ChevronRight, ChevronDown, ListFilter,
  Landmark, MapPin, Phone, Printer, Mail, Clock, ArrowRight, Megaphone
} from 'lucide-react';

// ==========================================
// ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (Configuration)
// ==========================================

const GOOGLE_SHEET_ID = '1Qx87R1oQd6m55H2R2hP1wFz3Y9_ZgO-QjJ8J4x5K6vM'; 

const CATEGORIES = [
  "üìã ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏†‡∏≤‡∏Ñ‡∏£‡∏±‡∏ê",
  "üíª New GFMIS Thai",
  "üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á ‡∏ö‡∏≥‡πÄ‡∏´‡∏ô‡πá‡∏à ‡∏ö‡∏≥‡∏ô‡∏≤‡∏ç",
  "üíµ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏á‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏•‡∏±‡∏á",
  "‚úàÔ∏è ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£",
  "üìö ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°",
  "üè• ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•",
  "üë®‚Äçüë©‚Äçüëß ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ö‡∏∏‡∏ï‡∏£",
  "üè† ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£",
  "üíº ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô",
  "üìå ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ"
];

const DEFAULT_CATEGORY = "üìå ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ";

export default function App() {
  // Page State
  const [isLandingPage, setIsLandingPage] = useState(true);

  // App Stat
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('All');
  const [selectedItem, setSelectedItem] = useState(null);
  const [darkMode, setDarkMode] = useState(() => localStorage.getItem('theme') === 'dark');
  const [bookmarks, setBookmarks] = useState(() => JSON.parse(localStorage.getItem('bookmarks') || '[]'));
  
  // Web Speech API State
  const [isSpeaking, setIsSpeaking] = useState(false);
  const [isPaused, setIsPaused] = useState(false);
  const [currentReadingId, setCurrentReadingId] = useState(null);
  const speechRef = useRef(null);

  // Fetch Data
  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        const url = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/gviz/tq?tqx=out:json`;
        const response = await fetch(url);
        if (!response.ok) throw new Error('Network response was not ok');
        const text = await response.text();
        const jsonData = JSON.parse(text.substring(47).slice(0, -2));
        const rows = jsonData.table.rows;
        
        const formattedData = rows.map((row, index) => {
          const rawCategory = row.c[2]?.v || '';
          const category = CATEGORIES.includes(rawCategory.trim()) 
            ? rawCategory.trim() 
            : DEFAULT_CATEGORY;
            
          return {
            id: row.c[3]?.v?.toString() || `id-${index}`,
            question: row.c[4]?.v || '',
            answer: row.c[5]?.v || '',
            category: category,
            updatedAt: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
          };
        }).filter(item => item.question !== '');
        
        setData(formattedData.length > 0 ? formattedData : getMockData());
        setLoading(false);
      } catch (err) {
        setData(getMockData());
        setLoading(false);
      }
    };
    fetchData();
  }, []);

  function getMockData() {
    return [
      { id: '1', question: '‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ö‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?', answer: '‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î', category: 'üè† ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£', updatedAt: '25/02/2026' },
      { id: '2', question: '‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 500,000 ‡∏ö‡∏≤‡∏ó ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏î?', answer: '‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡∏Ø ‡∏û.‡∏®. 2560', category: 'üìã ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏†‡∏≤‡∏Ñ‡∏£‡∏±‡∏ê', updatedAt: '20/02/2026' }
    ];
  }

  // Dark Mode
  useEffect(() => {
    document.documentElement.classList.toggle('dark', darkMode);
    localStorage.setItem('theme', darkMode ? 'dark' : 'light');
  }, [darkMode]);

  // Filters & Counts
  const filteredData = useMemo(() => {
    return data.filter(item => {
      const matchSearch = item.question.toLowerCase().includes(searchTerm.toLowerCase()) || 
                          item.answer.toLowerCase().includes(searchTerm.toLowerCase());
      const matchCategory = selectedCategory === 'All' || 
                            (selectedCategory === 'Bookmarks' ? bookmarks.includes(item.id) : item.category === selectedCategory);
      return matchSearch && matchCategory;
    });
  }, [data, searchTerm, selectedCategory, bookmarks]);

  const categoryCounts = useMemo(() => {
    const counts = { 'All': data.length, 'Bookmarks': bookmarks.length };
    CATEGORIES.forEach(cat => counts[cat] = 0);
    data.forEach(item => { if (counts[item.category] !== undefined) counts[item.category]++; });
    return counts;
  }, [data, bookmarks]);

  const toggleBookmark = (id, e) => {
    if(e) e.stopPropagation();
    const newBkmk = bookmarks.includes(id) ? bookmarks.filter(b => b !== id) : [...bookmarks, id];
    setBookmarks(newBkmk);
    localStorage.setItem('bookmarks', JSON.stringify(newBkmk));
  };

  // üîä ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á
  const initSpeech = (text, id = null) => {
    window.speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'th-TH';
    utterance.rate = 1.0;
    
    utterance.onstart = () => {
      setIsSpeaking(true);
      setIsPaused(false);
      setCurrentReadingId(id);
    };

    utterance.onend = () => {
      setIsSpeaking(false);
      setIsPaused(false);
      setCurrentReadingId(null);
    };

    speechRef.current = utterance;
    window.speechSynthesis.speak(utterance);
  };

  const handleToggleSpeech = (item, e) => {
    if(e) e.stopPropagation();
    const text = `‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ${item.question}. ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: ${item.answer}`;

    if (currentReadingId === item.id) {
      if (isPaused) {
        window.speechSynthesis.resume();
        setIsPaused(false);
      } else {
        window.speechSynthesis.pause();
        setIsPaused(true);
      }
    } else {
      initSpeech(text, item.id);
    }
  };

  const stopSpeech = () => {
    window.speechSynthesis.cancel();
    setIsSpeaking(false);
    setIsPaused(false);
    setCurrentReadingId(null);
  };

  const handleWelcomeSpeech = () => {
    initSpeech("‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà ‡∏Ñ‡∏•‡∏±‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏î‡∏µ ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏û‡∏π‡∏î‡πÑ‡∏î‡πâ ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£");
  };

  // ==========================================
  // üåü ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Landing Page (‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å)
  // ==========================================
  if (isLandingPage) {
    return (
      <div className={`min-h-screen flex flex-col items-center justify-center p-6 ${darkMode ? 'bg-slate-900' : 'bg-[#ccebfd]'}`}>
        
        {/* Toggle Dark Mode in Landing Page (Optional, hidden in screenshot but good for UX) */}
        <button onClick={() => setDarkMode(!darkMode)} className="absolute top-4 right-4 p-2 rounded-full bg-white/30 hover:bg-white/50 dark:bg-slate-800 text-slate-800 dark:text-slate-200 transition-colors">
          {darkMode ? <Sun size={20} /> : <Moon size={20} />}
        </button>

        {/* Logo Card */}
        <div className={`w-40 h-40 md:w-48 md:h-48 rounded-3xl shadow-lg flex items-center justify-center mb-8 overflow-hidden border-4 ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-white'}`}>
          {/* ‚ùó ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏à‡∏£‡∏¥‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ó‡∏µ‡πà src ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ 
            ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: <img src="https://yourwebsite.com/logo.png" alt="Logo" className="w-full h-full object-contain p-2" />
          */}
          <Landmark size={80} className={`opacity-80 ${darkMode ? 'text-blue-400' : 'text-blue-900'}`} />
          {/* ‡∏•‡∏ö‡πÅ‡∏ó‡πá‡∏Å Landmark ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏ó‡∏¥‡πâ‡∏á ‡∏´‡∏≤‡∏Å‡πÉ‡∏™‡πà‡πÅ‡∏ó‡πá‡∏Å img ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß */}
          {/* <img src="‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ" alt="Logo" className="w-full h-full object-contain p-4" /> */}
        </div>

        {/* Titles */}
        <div className="text-center space-y-3 mb-10">
          <h1 className={`text-2xl md:text-3xl font-bold ${darkMode ? 'text-slate-200' : 'text-[#1a365d]'}`}>
            ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà üéâ
          </h1>
          <h2 className={`text-4xl md:text-5xl font-black tracking-tight ${darkMode ? 'text-blue-400' : 'text-[#0f4a7c]'}`}>
            ‡∏Ñ‡∏•‡∏±‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏î‡∏µ
          </h2>
          <p className={`text-lg md:text-xl font-medium mt-4 ${darkMode ? 'text-slate-400' : 'text-[#3b6b91]'}`}>
            ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏û‡∏π‡∏î‡πÑ‡∏î‡πâ
          </p>
        </div>

        {/* Action Buttons */}
        <div className="flex flex-col items-center gap-5 w-full max-w-xs">
          {/* Sound Button */}
          <button 
            onClick={handleWelcomeSpeech}
            className={`w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl border-[3px] font-bold text-lg shadow-sm transition-all active:scale-95
              ${darkMode ? 'bg-slate-800 border-blue-500 text-blue-400 hover:bg-slate-700' : 'bg-white border-[#1f4287] text-[#1f4287] hover:bg-blue-50'}`}
          >
            <Volume2 size={24} className={isSpeaking && !currentReadingId ? "animate-pulse" : ""} />
            <span>üëâ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á üëà</span>
          </button>

          {/* Start Button */}
          <button 
            onClick={() => {
              setIsLandingPage(false);
              stopSpeech();
            }}
            className="w-full flex items-center justify-center gap-2 px-6 py-4 rounded-2xl bg-[#22a3e6] hover:bg-[#1a8bc7] text-white font-bold text-xl shadow-lg transition-all active:scale-95"
          >
            <ArrowRight size={24} />
            <span>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
          </button>
        </div>

        {/* Footer Info */}
        <div className={`mt-16 w-full max-w-sm flex flex-col items-center gap-2 text-sm ${darkMode ? 'text-slate-400' : 'text-[#6c8ba4]'}`}>
          <div className="flex items-center gap-2 font-bold mb-1 text-base">
            <Landmark size={18} />
            <span>‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£</span>
          </div>
          <div className="flex items-center gap-2 w-full pl-8">
            <MapPin size={16} className="opacity-70" /> <span>‡∏®‡∏≤‡∏•‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£</span>
          </div>
          <div className="flex items-center gap-2 w-full pl-8">
            <Phone size={16} className="opacity-70" /> <span>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: 0-4271-1405</span>
          </div>
          <div className="flex items-center gap-2 w-full pl-8">
            <Printer size={16} className="opacity-70" /> <span>‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£: 0-4271-3371</span>
          </div>
          <div className="flex items-center gap-2 w-full pl-8">
            <Mail size={16} className="opacity-70" /> 
            <span>E-Mail: <a href="mailto:SKN@CGD.GO.TH" className="underline hover:text-blue-500">SKN@CGD.GO.TH</a></span>
          </div>
          <div className="flex items-center gap-2 w-full pl-8">
            <Clock size={16} className="opacity-70" /> <span>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£: ‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå - ‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå</span>
          </div>
        </div>

      </div>
    );
  }

  // ==========================================
  // üåü ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å Application
  // ==========================================
  return (
    <div className={`min-h-screen ${darkMode ? 'bg-slate-900 text-slate-100' : 'bg-slate-50 text-slate-800'} transition-colors duration-300`}>
      {/* Navbar */}
      <nav className={`${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-[#0f4a7c] border-[#0a3860]'} text-white sticky top-0 z-40 shadow-lg px-4 py-3`}>
        <div className="max-w-6xl mx-auto flex justify-between items-center">
          <div className="flex items-center space-x-3 cursor-pointer" onClick={() => {setSearchTerm(''); setSelectedCategory('All'); stopSpeech();}}>
            <div className="bg-white p-2 rounded-xl text-[#0f4a7c] shadow-sm"><BookOpen size={24} /></div>
            <div>
              <h1 className="text-xl font-bold leading-none">‡∏Ñ‡∏•‡∏±‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏î‡∏µ</h1>
              <p className="text-[10px] text-blue-200 uppercase tracking-wider mt-1">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£</p>
            </div>
          </div>
          <button onClick={() => setDarkMode(!darkMode)} className="p-2.5 rounded-full hover:bg-white/10 transition-colors">
            {darkMode ? <Sun size={20} /> : <Moon size={20} />}
          </button>
        </div>
      </nav>

      <main className="max-w-4xl mx-auto px-4 py-8">
        {/* Search and Category Filter Section */}
        <div className="space-y-4 mb-8">
          <div className="relative group">
            <input 
              type="text" 
              placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏á‡∏™‡∏±‡∏¢..." 
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className={`w-full pl-12 pr-4 py-4 rounded-2xl border-2 transition-all outline-none text-lg shadow-sm
                ${darkMode ? 'bg-slate-800 border-slate-700 focus:border-blue-500' : 'bg-white border-slate-200 focus:border-[#22a3e6]'}`}
            />
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-[#22a3e6] transition-colors" size={24} />
          </div>

          <div className="flex flex-col sm:flex-row gap-3">
            <div className="relative flex-1">
              <ListFilter className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none" size={18} />
              <select 
                value={selectedCategory}
                onChange={(e) => {setSelectedCategory(e.target.value); stopSpeech();}}
                className={`w-full pl-11 pr-10 py-3.5 rounded-2xl border-2 appearance-none cursor-pointer outline-none transition-all font-medium
                  ${darkMode ? 'bg-slate-800 border-slate-700 hover:border-slate-600' : 'bg-white border-slate-200 hover:border-slate-300'}`}
              >
                <option value="All">üåê ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ({categoryCounts['All']})</option>
                <option value="Bookmarks">‚≠ê ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ ({categoryCounts['Bookmarks']})</option>
                <hr className="my-1" />
                {CATEGORIES.map(cat => (
                  <option key={cat} value={cat}>{cat} ({categoryCounts[cat] || 0})</option>
                ))}
              </select>
              <ChevronDown className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none" size={18} />
            </div>
            
            <button 
              onClick={() => {setSearchTerm(''); setSelectedCategory('All'); stopSpeech();}}
              className={`px-6 py-3.5 rounded-2xl font-bold transition-all border-2
                ${darkMode ? 'bg-slate-700 border-slate-600 hover:bg-slate-600' : 'bg-slate-200 border-slate-200 hover:bg-slate-300 text-slate-700'}`}
            >
              ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤
            </button>
          </div>
        </div>

        {/* Content Area */}
        {loading ? (
          <div className="text-center py-20 animate-pulse">
            <div className="w-12 h-12 bg-[#22a3e6] rounded-full mx-auto mb-4 animate-bounce"></div>
            <p className="text-slate-500 font-medium">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
          </div>
        ) : (
          <div className="grid gap-4">
            {filteredData.map(item => (
              <div 
                key={item.id}
                onClick={() => setSelectedItem(item)}
                className={`p-5 rounded-3xl border-2 transition-all cursor-pointer shadow-sm hover:shadow-md active:scale-[0.99] group
                  ${darkMode ? 'bg-slate-800 border-slate-700 hover:border-blue-500' : 'bg-white border-slate-200 hover:border-[#22a3e6]'}`}
              >
                <div className="flex justify-between items-start gap-4 mb-3">
                  <span className={`text-[10px] font-bold px-2.5 py-1 rounded-lg uppercase tracking-wider
                    ${darkMode ? 'bg-blue-900/40 text-blue-300' : 'bg-blue-50 text-[#0f4a7c]'}`}>
                    {item.category}
                  </span>
                  <div className="flex gap-2">
                    <button 
                      onClick={(e) => handleToggleSpeech(item, e)}
                      className={`p-2 rounded-full transition-all ${currentReadingId === item.id ? 'bg-[#22a3e6] text-white animate-pulse' : 'bg-slate-100 dark:bg-slate-700 text-slate-400 hover:text-[#22a3e6]'}`}
                      title="‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á"
                    >
                      {currentReadingId === item.id && !isPaused ? <Pause size={18} fill="currentColor" /> : <Volume2 size={18} />}
                    </button>
                    <button onClick={(e) => toggleBookmark(item.id, e)} className={bookmarks.includes(item.id) ? 'text-amber-500' : 'text-slate-300'}>
                      <Bookmark size={20} fill={bookmarks.includes(item.id) ? "currentColor" : "none"} />
                    </button>
                  </div>
                </div>
                <h3 className="text-lg font-bold leading-snug mb-2 group-hover:text-[#0f4a7c] dark:group-hover:text-blue-400 transition-colors">{item.question}</h3>
                <p className={`text-sm line-clamp-2 ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>{item.answer}</p>
                <div className="mt-4 pt-4 border-t border-dashed border-slate-200 dark:border-slate-700 flex justify-between items-center text-[11px] text-slate-400">
                   <div className="flex items-center gap-1">
                     <Info size={12} />
                     <span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏•‡∏±‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏î‡∏µ</span>
                   </div>
                   <span className="flex items-center text-[#22a3e6] font-bold group-hover:translate-x-1 transition-transform">‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡πà‡∏≤‡∏ô <ChevronRight size={14} /></span>
                </div>
              </div>
            ))}
            {filteredData.length === 0 && (
              <div className="text-center py-20 opacity-40">
                <Search size={64} className="mx-auto mb-4" />
                <p className="text-xl font-bold">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
              </div>
            )}
          </div>
        )}
      </main>

      {/* Modal */}
      {selectedItem && (
        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4">
          <div className="absolute inset-0 bg-slate-900/80 backdrop-blur-sm" onClick={() => {setSelectedItem(null); stopSpeech();}}></div>
          <div className={`relative w-full max-w-2xl max-h-[90vh] overflow-hidden rounded-t-3xl sm:rounded-3xl shadow-2xl flex flex-col transition-all transform
            ${darkMode ? 'bg-slate-800' : 'bg-white'}`}>
            <div className="flex justify-between items-center p-5 border-b dark:border-slate-700">
              <span className="text-xs font-bold text-[#22a3e6]">{selectedItem.category}</span>
              <button onClick={() => {setSelectedItem(null); stopSpeech();}} className="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
                <X size={24} />
              </button>
            </div>
            <div className="p-6 overflow-y-auto">
              <h2 className="text-2xl font-black mb-6 leading-tight text-[#0f4a7c] dark:text-white">{selectedItem.question}</h2>
              <div className={`text-lg leading-relaxed whitespace-pre-wrap ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>{selectedItem.answer}</div>
              <div className="mt-8 text-xs text-slate-500 italic">‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏•‡∏±‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏î‡∏µ</div>
            </div>
            <div className={`p-6 border-t dark:border-slate-700 ${darkMode ? 'bg-slate-900/50' : 'bg-[#eef8ff]'}`}>
              <div className="flex flex-col gap-4">
                <div className="flex items-center gap-2 text-[#22a3e6] font-bold"><Volume2 size={20} /> ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á</div>
                <div className="flex gap-2">
                  <button 
                    onClick={() => handleToggleSpeech(selectedItem)}
                    className={`flex-1 flex items-center justify-center gap-2 py-4 rounded-2xl font-bold text-white shadow-lg active:scale-95 transition-all
                    ${currentReadingId === selectedItem.id && !isPaused ? 'bg-amber-500 shadow-amber-500/30' : 'bg-[#22a3e6] shadow-[#22a3e6]/30'}`}
                  >
                    {currentReadingId === selectedItem.id && !isPaused ? <><Pause size={20} fill="currentColor" /> ‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏±‡∏Å</> : <><Play size={20} fill="currentColor" /> {isPaused ? '‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠' : '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô'}</>}
                  </button>
                  <button 
                    onClick={() => initSpeech(`‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ${selectedItem.question}. ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: ${selectedItem.answer}`, selectedItem.id)}
                    className="p-4 rounded-2xl border-2 border-[#bae0f5] dark:border-slate-600 text-[#22a3e6] hover:bg-white transition-colors"
                  >
                    <RotateCcw size={20} />
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}


